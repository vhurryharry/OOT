<app-loader></app-loader>

<section class="hero is-primary is-bold">
  <div class="hero-body">
    <div class="container">
      <h1 class="title is-spaced">Enroll now</h1>
      <h2 class="subtitle">Join the growing community of impassioned experts who are using their knowledge to make big things happen.</h2>
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8">
        <form #checkoutForm="ngForm" (ngSubmit)="onSubmit(checkoutForm)">
          <div class="field is-horizontal">
            <div class="field-label is-normal">
              <label class="label">Personal info</label>
            </div>
            <div class="field-body">
              <div class="field">
                <p class="control is-expanded has-icons-left">
                  <input
                    required
                    class="input"
                    type="text"
                    placeholder="Full name"
                    [ngClass]="{'is-danger': !pickedName.valid && pickedName.touched}"
                    [(ngModel)]="name"
                    name="name"
                    #pickedName="ngModel">
                  <span class="icon is-small is-left">
                    <i class="fas fa-user"></i>
                  </span>
                </p>
                <p class="help is-danger" *ngIf="!pickedName.valid && pickedName.touched">This name is invalid</p>
              </div>

              <div class="field">
                <p class="control is-expanded has-icons-left has-icons-right">
                  <input
                    required
                    class="input"
                    type="email"
                    placeholder="your@email.com"
                    [ngClass]="{'is-danger': !pickedEmail.valid && pickedEmail.touched}"
                    [(ngModel)]="email"
                    name="email"
                    #pickedEmail="ngModel">
                  <span class="icon is-small is-left">
                    <i class="fas fa-envelope"></i>
                  </span>
                  <span class="icon is-small is-right">
                    <i class="fas fa-check"></i>
                  </span>
                </p>
                <p class="help is-danger" *ngIf="!pickedEmail.valid && pickedEmail.touched">This email is invalid</p>
              </div>
            </div>
          </div>

          <div class="field is-horizontal">
            <div class="field-label"></div>
            <div class="field-body">
              <div class="field is-expanded">
                <div class="field has-addons">
                  <p class="control">
                    <a class="button is-static">
                      +1
                    </a>
                  </p>
                  <p class="control is-expanded">
                    <input
                      required
                      class="input"
                      type="tel"
                      placeholder="Phone number"
                      [ngClass]="{'is-danger': !pickedPhone.valid && pickedPhone.touched}"
                      [(ngModel)]="phone"
                      name="phone"
                      #pickedPhone="ngModel">
                  </p>
                  <p class="help is-danger" *ngIf="!pickedPhone.valid && pickedPhone.touched">This phone is invalid</p>
                </div>
              </div>
            </div>
          </div>

          <hr />

          <div class="field is-horizontal">
            <div class="field-label">
              <label class="label">Payment</label>
            </div>
            <div class="field-body hero">
              <div id="card-info" #cardInfo></div>
              <div id="card-errors" role="alert" *ngIf="error">{{ error }}</div>
            </div>
          </div>

          <div class="field is-horizontal">
            <div class="field-label">
            </div>
            <div class="field-body">
            </div>
          </div>

          <div class="field is-horizontal">
            <div class="field-label">
            </div>
            <div class="field-body">
              <div class="field">
                <div class="control">
                  <button class="button is-primary" type="submit" [disabled]="!checkoutForm.form.valid || enrollmentPending" [ngClass]="{'is-loading': enrollmentPending}">
                    Enroll now
                  </button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="column is-4" *ngIf="ready">
        <div class="list is-hoverable">
          <a class="list-item" *ngFor="let item of order.items">
            <div class="level is-mobile">
              <div class="level-left">
                <div class="level-item">
                  <div>
                    <h6 class="title is-6">{{ item.title }}</h6>
                    <small>{{ item.option }}</small>
                  </div>
                </div>
              </div>
              <div class="level-right"><span>{{ item.unitPrice }}</span></div>
            </div>
          </a>

          <div class="list-item">
            <div class="level is-mobile">
              <div class="level-left">
                <div class="level-item">Total</div>
              </div>
              <div class="level-right">
                <div class="level-item">
                  <strong>{{ order.grandTotal }}</strong>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="modal" *ngIf="showSuccessModal" [ngClass]="{'is-active': showSuccessModal}">
  <div class="modal-background animated fadeIn"></div>
  <div class="modal-card animated slideInDown">
    <header class="modal-card-head">
      <p class="modal-card-title">Thank you for enrolling!</p>
    </header>
    <section class="modal-card-body">
      <article class="message is-success">
        <div class="message-body">
          Your order number is <strong>{{ placedOrder.number }}</strong>.
        </div>
      </article>
    </section>
  </div>
</div>
